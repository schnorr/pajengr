#+TITLE: Maintenance ORG file for pajengr package
#+AUTHOR: Lucas Mello Schnorr
#+STARTUP: overview indent
#+TAGS: noexport(n) deprecated(d)
#+EXPORT_SELECT_TAGS: export
#+EXPORT_EXCLUDE_TAGS: noexport

The package has been created with Rcpp's version of =package.skeleton=,
by running the following code. This is no longer necessary because the
package has already been created and modified. The contents of the
pajengr directory created by the =Rcpp.package.skeleton= have been
copied to the root directory of this repository.

#+begin_src R :results output :session :exports both
library(Rcpp);
Rcpp.package.skeleton("pajengr");
#+end_src

#+RESULTS:
#+begin_example
Creating directories ...
Creating DESCRIPTION ...
Creating NAMESPACE ...
Creating Read-and-delete-me ...
Saving functions and data ...
Making help files ...
Done.
Further steps are described in './pajengr/Read-and-delete-me'.

Adding Rcpp settings
 >> added Imports: Rcpp
 >> added LinkingTo: Rcpp
 >> added useDynLib directive to NAMESPACE
 >> added importFrom(Rcpp, evalCpp) directive to NAMESPACE
 >> added example src file using Rcpp attributes
 >> added Rd file for rcpp_hello_world
 >> compiled Rcpp attributes
#+end_example

Every time some new function is exported, we need to recompile the
attributes in the following way, so our R API gets updated.

#+begin_src R :results output :exports both
library(Rcpp);
unlink("src/RcppExports.cpp")
compileAttributes(".");
#+end_src

#+RESULTS:

The package can be checked and installed the following way (for
development purposes only). Please note that the standard installation
procedure [[./README.org][has already been described in the README file]]. Note that the
following commands should be executed considering the existence of a
=pajengr= directory with the contents of this repository. If you are
within the aforementioned directory, replace pajengr by the dot.

#+begin_src shell :results output
#R CMD check .
R CMD INSTALL .
#+end_src

#+RESULTS:
#+begin_example
-- Configuring done
-- Generating done
-- Build files have been written to: /home/schnorr/dev/pajengr/src/pajeng.build
/usr/bin/cmake -H/home/schnorr/dev/pajengr/src/pajeng -B/home/schnorr/dev/pajengr/src/pajeng.build --check-build-system CMakeFiles/Makefile.cmake 0
/usr/bin/cmake -E cmake_progress_start /home/schnorr/dev/pajengr/src/pajeng.build/CMakeFiles /home/schnorr/dev/pajengr/src/pajeng.build/CMakeFiles/progress.marks
make -f CMakeFiles/Makefile2 all
make[1]: Entering directory '/home/schnorr/dev/pajengr/src/pajeng.build'
make -f src/libpaje/CMakeFiles/paje_library_static.dir/build.make src/libpaje/CMakeFiles/paje_library_static.dir/depend
make[2]: Entering directory '/home/schnorr/dev/pajengr/src/pajeng.build'
cd /home/schnorr/dev/pajengr/src/pajeng.build && /usr/bin/cmake -E cmake_depends "Unix Makefiles" /home/schnorr/dev/pajengr/src/pajeng /home/schnorr/dev/pajengr/src/pajeng/src/libpaje /home/schnorr/dev/pajengr/src/pajeng.build /home/schnorr/dev/pajengr/src/pajeng.build/src/libpaje /home/schnorr/dev/pajengr/src/pajeng.build/src/libpaje/CMakeFiles/paje_library_static.dir/DependInfo.cmake --color=
make[2]: Leaving directory '/home/schnorr/dev/pajengr/src/pajeng.build'
make -f src/libpaje/CMakeFiles/paje_library_static.dir/build.make src/libpaje/CMakeFiles/paje_library_static.dir/build
make[2]: Entering directory '/home/schnorr/dev/pajengr/src/pajeng.build'
make[2]: Nothing to be done for 'src/libpaje/CMakeFiles/paje_library_static.dir/build'.
make[2]: Leaving directory '/home/schnorr/dev/pajengr/src/pajeng.build'
[100%] Built target paje_library_static
make[1]: Leaving directory '/home/schnorr/dev/pajengr/src/pajeng.build'
/usr/bin/cmake -E cmake_progress_start /home/schnorr/dev/pajengr/src/pajeng.build/CMakeFiles 0
make: Nothing to be done for 'all'.
#+end_example

Contents of the REad-and-delete-me file:

#+BEGIN_EXAMPLE
- Edit the help file skeletons in 'man', possibly combining help files for multiple functions.
- Edit the exports in 'NAMESPACE', and add necessary imports.
- Put any C/C++/Fortran code in 'src'.
- If you have compiled code, add a useDynLib() directive to 'NAMESPACE'.
- Run R CMD build to build the package tarball.
- Run R CMD check to check the package tarball.
#+END_EXAMPLE

And then, test to verify if the installation is working.

#+begin_src R :results output :exports both :session
library(pajengr)
suppressMessages(library(tidyverse))
pajeng_read("../pajeng/traces/simu-mardi.trace") -> x;
lapply(x, object.size)
x$container %>% as_tibble()
x$state %>% as_tibble()
x$variable %>% as_tibble()
x$event %>% as_tibble()
x$link %>% as_tibble()
#+end_src

#+RESULTS:
#+begin_example

$container
40472 bytes

$state
606408 bytes

$variable
49560 bytes

$event
2760 bytes

$link
75024 bytes

# A tibble: 307 x 7
   Nature    Parent       Type   Start   End Duration Container                
   <fct>     <fct>        <fct>  <dbl> <dbl>    <dbl> <fct>                    
 1 Container NULL         0          0  1205     1205 0                        
 2 Container 0            L1         0  1205     1205 my_cluster_1             
 3 Container my_cluster_1 ROUTER     0  1205     1205 nodemy_cluster_1_router  
 4 Container my_cluster_1 LINK       0  1205     1205 my_cluster_1_link_32_UP  
 5 Container my_cluster_1 LINK       0  1205     1205 my_cluster_1_link_31_DOWN
 6 Container my_cluster_1 LINK       0  1205     1205 my_cluster_1_link_31_UP  
 7 Container my_cluster_1 LINK       0  1205     1205 my_cluster_1_link_30_DOWN
 8 Container my_cluster_1 LINK       0  1205     1205 my_cluster_1_link_30_UP  
 9 Container my_cluster_1 LINK       0  1205     1205 my_cluster_1_link_29_DOWN
10 Container my_cluster_1 LINK       0  1205     1205 my_cluster_1_link_29_UP  
# ... with 297 more rows

# A tibble: 13,620 x 8
   Nature Container Type  Start   End Duration Imbrication Value 
   <fct>  <fct>     <fct> <dbl> <dbl>    <dbl>       <int> <fct> 
 1 State  node32    PM      100   222      122           0 normal
 2 State  node32    PM      222   256       34           0 normal
 3 State  node32    PM      256   268       12           0 normal
 4 State  node32    PM      268   291       23           0 normal
 5 State  node32    PM      291   303       12           0 normal
 6 State  node32    PM      303   425      122           0 normal
 7 State  node32    PM      425   503       78           0 normal
 8 State  node32    PM      503   515       12           0 normal
 9 State  node32    PM      515   538       23           0 normal
10 State  node32    PM      538   554       16           0 normal
# ... with 13,610 more rows

# A tibble: 507 x 7
   Nature   Container                 Type      Start   End Duration   Value
   <fct>    <fct>                     <fct>     <dbl> <dbl>    <dbl>   <dbl>
 1 Variable my_cluster_1_link_32_UP   bandwidth     0  1205     1205 1.25e+8
 2 Variable my_cluster_1_link_32_UP   latency       0  1205     1205 5.00e-5
 3 Variable my_cluster_1_link_31_DOWN bandwidth     0  1205     1205 1.25e+8
 4 Variable my_cluster_1_link_31_DOWN latency       0  1205     1205 5.00e-5
 5 Variable my_cluster_1_link_31_UP   bandwidth     0  1205     1205 1.25e+8
 6 Variable my_cluster_1_link_31_UP   latency       0  1205     1205 5.00e-5
 7 Variable my_cluster_1_link_30_DOWN bandwidth     0  1205     1205 1.25e+8
 8 Variable my_cluster_1_link_30_DOWN latency       0  1205     1205 5.00e-5
 9 Variable my_cluster_1_link_30_UP   bandwidth     0  1205     1205 1.25e+8
10 Variable my_cluster_1_link_30_UP   latency       0  1205     1205 5.00e-5
# ... with 497 more rows

# A tibble: 0 x 5
# ... with 5 variables: Nature <fct>, Container <fct>, Type <fct>, Start <dbl>,
#   Value <fct>

# A tibble: 405 x 10
   Nature Container Type  Start   End Duration Value StartContainer EndContainer
   <fct>  <fct>     <fct> <dbl> <dbl>    <dbl> <fct> <fct>          <fct>       
 1 State  my_clust… L1-L…     0     0        0 G     my_cluster_1_… node21      
 2 State  my_clust… L1-L…     0     0        0 G     my_cluster_1_… node22      
 3 State  my_clust… L1-L…     0     0        0 G     my_cluster_1_… node23      
 4 State  my_clust… L1-L…     0     0        0 G     my_cluster_1_… node24      
 5 State  my_clust… L1-L…     0     0        0 G     my_cluster_1_… node25      
 6 State  my_clust… L1-L…     0     0        0 G     my_cluster_1_… node26      
 7 State  my_clust… L1-L…     0     0        0 G     my_cluster_1_… node27      
 8 State  my_clust… L1-L…     0     0        0 G     my_cluster_1_… node28      
 9 State  my_clust… L1-L…     0     0        0 G     my_cluster_1_… node29      
10 State  my_clust… L1-L…     0     0        0 G     my_cluster_1_… node30      
# ... with 395 more rows, and 1 more variable: Key <fct>
#+end_example

Test exception handling

#+begin_src R :results output :exports both :session
library(pajengr)
suppressMessages(library(tidyverse))
pajeng_read("./traces/starpu.buggy.trace")
#+end_src

#+RESULTS:
: 
: PajeContainerException: Unknown container 'mm0' in (Line: 377, Fields: '5, Contents: '6 0.000000000 mm0 use 0.000000')
: list()




